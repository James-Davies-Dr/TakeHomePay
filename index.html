<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NHS Doctor Pay & Budget Calculator</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
        }
        .info-detail {
            font-size: 0.875rem; /* text-sm */
            color: #4b5563; /* gray-700 */
            margin-left: 1.5rem; /* ml-6 */
        }
        .page {
            display: none; /* Hidden by default */
        }
        .page.active {
            display: block; /* Show active active */
        }
        .input-field {
            @apply shadow-sm appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out;
        }
        .select-field {
            @apply shadow-sm appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition duration-200 ease-in-out;
        }
        .category-heading {
            @apply text-lg font-semibold text-blue-700 mb-3 border-b pb-2 border-blue-200;
        }
    </style>
</head>
<body class="p-4 sm:p-6 md:p-8 lg:p-10 bg-gray-100 min-h-screen flex items-center justify-center">
    <div class="bg-white p-6 sm:p-8 rounded-xl shadow-lg w-full max-w-xl md:max-w-2xl lg:max-w-3xl">
        <h1 class="text-2xl sm:text-3xl font-bold text-center text-blue-700 mb-6">NHS Doctor Pay & Budget Calculator</h1>

        <!-- Page 1: Take-Home Pay Calculator -->
        <div id="page-calculator" class="page active">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div class="mb-4 md:mb-0">
                    <label for="taxYear" class="block text-gray-700 text-sm font-semibold mb-2">
                        Select Tax Year:
                    </label>
                    <select id="taxYear"
                            class="input-field"
                            onchange="calculatePay()">
                        <option value="2024/2025" selected>2024/2025</option>
                        <option value="2025/2026">2025/2026</option>
                    </select>
                </div>

                <div class="mb-4 md:mb-0">
                    <label for="baseSalaryAnnual" class="block text-gray-700 text-sm font-semibold mb-2">
                        Base Annual Salary (£):
                    </label>
                    <input type="number" id="baseSalaryAnnual" value="80000" min="0"
                           class="input-field"
                           oninput="calculatePay()">
                </div>

                <div class="mb-4 md:mb-0">
                    <label for="locumRate" class="block text-gray-700 text-sm font-semibold mb-2">
                        Locum Hourly Rate (£):
                    </label>
                    <input type="number" id="locumRate" value="80" min="0"
                           class="input-field"
                           oninput="calculatePay()">
                </div>

                <div class="mb-4 md:mb-0">
                    <label for="locumHours" class="block text-gray-700 text-sm font-semibold mb-2">
                        Additional Locum Hours per Month:
                    </label>
                    <input type="number" id="locumHours" value="20" min="0"
                           class="input-field"
                           oninput="calculatePay()">
                </div>

                <div class="mb-4 md:mb-0">
                    <label for="salarySacrificeMonthly" class="block text-gray-700 text-sm font-semibold mb-2">
                        Monthly Salary Sacrifice Amount (£):
                    </label>
                    <input type="number" id="salarySacrificeMonthly" value="0" min="0"
                           class="input-field"
                           oninput="calculatePay()">
                </div>

                <div class="mb-4 md:mb-0">
                    <label for="monthlySIPPContribution" class="block text-gray-700 text-sm font-semibold mb-2">
                        Monthly SIPP Contribution (Net) (£):
                    </label>
                    <input type="number" id="monthlySIPPContribution" value="0" min="0"
                           class="input-field"
                           oninput="calculatePay()">
                </div>
            </div>

            <div class="bg-blue-50 p-4 rounded-lg mb-6">
                <h2 class="text-lg font-semibold text-blue-800 mb-3">Pay Breakdown:</h2>
                <div class="space-y-2 text-gray-800">
                    <p><strong>Total Gross Annual Income:</strong> <span id="annualGross" class="font-medium"></span></p>
                    <p><strong>Total Gross Monthly Income:</strong> <span id="monthlyGross" class="font-medium"></span></p>

                    <p class="pt-2 border-t border-blue-200"><strong>Annual Pension Contribution:</strong> <span id="annualPension" class="font-medium text-red-600"></span></p>
                    <p class="info-detail" id="pensionRateDetail"></p>
                    <p><strong>Monthly Pension Contribution:</strong> <span id="monthlyPension" class="font-medium text-red-600"></span></p>

                    <p><strong>Annual Salary Sacrifice:</strong> <span id="annualSalarySacrifice" class="font-medium text-red-600"></span></p>
                    <p><strong>Monthly Salary Sacrifice:</strong> <span id="monthlySalarySacrifice" class="font-medium text-red-600"></span></p>

                    <p><strong>Annual SIPP Contribution (Net):</strong> <span id="annualSIPPContributionDisplay" class="font-medium text-red-600"></span></p>
                    <p><strong>Monthly SIPP Contribution (Net):</strong> <span id="monthlySIPPContributionDisplay" class="font-medium text-red-600"></span></p>
                    <p class="info-detail" id="sippTaxReliefDetail"></p>
                    <p><strong>Annual SIPP Tax Relief:</strong> <span id="annualSIPP_TaxRelief" class="font-medium text-green-700"></span></p>
                    <p><strong>Monthly SIPP Tax Relief:</strong> <span id="monthlySIPP_TaxRelief" class="font-medium text-green-700"></span></p>


                    <p class="pt-2 border-t border-blue-200"><strong>Annual Income Tax:</strong> <span id="annualTax" class="font-medium text-red-600"></span></p>
                    <div id="taxBreakdown" class="info-detail space-y-1"></div>
                    <p><strong>Monthly Income Tax:</strong> <span id="monthlyTax" class="font-medium text-red-600"></span></p>

                    <p><strong>Annual National Insurance:</strong> <span id="annualNI" class="font-medium text-red-600"></span></p>
                    <div id="niBreakdown" class="info-detail space-y-1"></div>
                    <p><strong>Monthly National Insurance:</strong> <span id="monthlyNI" class="font-medium text-red-600"></span></p>

                    <p class="pt-2 border-t border-blue-200"><strong>Annual Personal Allowance Lost:</strong> <span id="annualPALost" class="font-medium text-red-600"></span></p>
                    <p><strong>Monthly Personal Allowance Lost:</strong> <span id="monthlyPALost" class="font-medium text-red-600"></span></p>

                    <p class="pt-2 border-t border-blue-200"><strong>Monthly Take-Home Pay:</strong> <span id="monthlyNet" class="font-bold text-green-700 text-xl"></span></p>
                    <p><strong>Annual Take-Home Pay:</strong> <span id="annualNet" class="font-bold text-green-700 text-xl"></span></p>
                </div>
            </div>
            <button onclick="showPage('page-outgoings')"
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg shadow-md transition duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75">
                View Outgoings
            </button>
        </div>

        <!-- Page 2: Outgoings and Budget -->
        <div id="page-outgoings" class="page">
            <h2 class="text-xl sm:text-2xl font-bold text-center text-blue-700 mb-6">Your Monthly Outgoings</h2>

            <div class="bg-blue-50 p-4 rounded-lg mb-6">
                <p class="text-lg font-semibold text-blue-800">
                    Your Monthly Take-Home Pay: <span id="outgoingsMonthlyNet" class="font-bold text-green-700"></span>
                </p>
                <p class="text-lg font-semibold text-blue-800">
                    Your Annual Take-Home Pay: <span id="outgoingsAnnualNet" class="font-bold text-green-700"></span>
                </p>
            </div>

            <!-- Outgoings Categories -->
            <div class="space-y-6">
                <!-- Housing -->
                <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
                    <h3 class="category-heading">Housing</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="housing_mortgageRent" class="block text-gray-700 text-sm font-semibold mb-2">Mortgage/Rent (£):</label>
                            <div class="flex space-x-2">
                                <input type="number" id="housing_mortgageRent" value="1000" min="0" class="input-field" oninput="calculateOutgoings()">
                                <select id="housing_mortgageRent_freq" class="select-field w-auto" onchange="calculateOutgoings()">
                                    <option value="monthly">Monthly</option>
                                    <option value="quarterly">Quarterly</option>
                                    <option value="annually">Annually</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label for="housing_councilTax" class="block text-gray-700 text-sm font-semibold mb-2">Council Tax (£):</label>
                            <div class="flex space-x-2">
                                <input type="number" id="housing_councilTax" value="150" min="0" class="input-field" oninput="calculateOutgoings()">
                                <select id="housing_councilTax_freq" class="select-field w-auto" onchange="calculateOutgoings()">
                                    <option value="monthly">Monthly</option>
                                    <option value="quarterly">Quarterly</option>
                                    <option value="annually">Annually</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label for="housing_houseInsurance" class="block text-gray-700 text-sm font-semibold mb-2">House Insurance (£):</label>
                            <div class="flex space-x-2">
                                <input type="number" id="housing_houseInsurance" value="30" min="0" class="input-field" oninput="calculateOutgoings()">
                                <select id="housing_houseInsurance_freq" class="select-field w-auto" onchange="calculateOutgoings()">
                                    <option value="monthly">Monthly</option>
                                    <option value="annually">Annually</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label for="housing_maintenance" class="block text-gray-700 text-sm font-semibold mb-2">Household Maintenance Costs (£):</label>
                            <div class="flex space-x-2">
                                <input type="number" id="housing_maintenance" value="50" min="0" class="input-field" oninput="calculateOutgoings()">
                                <select id="housing_maintenance_freq" class="select-field w-auto" onchange="calculateOutgoings()">
                                    <option value="monthly">Monthly</option>
                                    <option value="quarterly">Quarterly</option>
                                    <option value="annually">Annually</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Services -->
                <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
                    <h3 class="category-heading">Services</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="services_octopus" class="block text-gray-700 text-sm font-semibold mb-2">Octopus (Electric & Gas) (£):</label>
                            <div class="flex space-x-2">
                                <input type="number" id="services_octopus" value="150" min="0" class="input-field" oninput="calculateOutgoings()">
                                <select id="services_octopus_freq" class="select-field w-auto" onchange="calculateOutgoings()">
                                    <option value="monthly">Monthly</option>
                                    <option value="quarterly">Quarterly</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label for="services_severnTrent" class="block text-gray-700 text-sm font-semibold mb-2">Severn Trent (Water) (£):</label>
                            <div class="flex space-x-2">
                                <input type="number" id="services_severnTrent" value="40" min="0" class="input-field" oninput="calculateOutgoings()">
                                <select id="services_severnTrent_freq" class="select-field w-auto" onchange="calculateOutgoings()">
                                    <option value="monthly">Monthly</option>
                                    <option value="quarterly">Quarterly</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label for="services_phoneInternet" class="block text-gray-700 text-sm font-semibold mb-2">Phone/Internet (£):</label>
                            <div class="flex space-x-2">
                                <input type="number" id="services_phoneInternet" value="50" min="0" class="input-field" oninput="calculateOutgoings()">
                                <select id="services_phoneInternet_freq" class="select-field w-auto" onchange="calculateOutgoings()">
                                    <option value="monthly">Monthly</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label for="services_streamingTV" class="block text-gray-700 text-sm font-semibold mb-2">Streaming/TV Licence (£):</label>
                            <div class="flex space-x-2">
                                <input type="number" id="services_streamingTV" value="20" min="0" class="input-field" oninput="calculateOutgoings()">
                                <select id="services_streamingTV_freq" class="select-field w-auto" onchange="calculateOutgoings()">
                                    <option value="monthly">Monthly</option>
                                    <option value="annually">Annually</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label for="services_other" class="block text-gray-700 text-sm font-semibold mb-2">Other Services (£):</label>
                            <div class="flex space-x-2">
                                <input type="number" id="services_other" value="0" min="0" class="input-field" oninput="calculateOutgoings()">
                                <select id="services_other_freq" class="select-field w-auto" onchange="calculateOutgoings()">
                                    <option value="monthly">Monthly</option>
                                    <option value="quarterly">Quarterly</option>
                                    <option value="annually">Annually</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Car 1: Leon -->
                <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
                    <h3 class="category-heading">Car 1: Leon</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="car1_fuel" class="block text-gray-700 text-sm font-semibold mb-2">Fuel (£):</label>
                            <div class="flex space-x-2">
                                <input type="number" id="car1_fuel" value="150" min="0" class="input-field" oninput="calculateOutgoings()">
                                <select id="car1_fuel_freq" class="select-field w-auto" onchange="calculateOutgoings()">
                                    <option value="monthly">Monthly</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label for="car1_tax" class="block text-gray-700 text-sm font-semibold mb-2">Car Tax (£):</label>
                            <div class="flex space-x-2">
                                <input type="number" id="car1_tax" value="180" min="0" class="input-field" oninput="calculateOutgoings()">
                                <select id="car1_tax_freq" class="select-field w-auto" onchange="calculateOutgoings()">
                                    <option value="annually">Annually</option>
                                    <option value="monthly">Monthly</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label for="car1_mot" class="block text-gray-700 text-sm font-semibold mb-2">MOT (£):</label>
                            <div class="flex space-x-2">
                                <input type="number" id="car1_mot" value="50" min="0" class="input-field" oninput="calculateOutgoings()">
                                <select id="car1_mot_freq" class="select-field w-auto" onchange="calculateOutgoings()">
                                    <option value="annually">Annually</option>
                                    <option value="monthly">Monthly</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label for="car1_service" class="block text-gray-700 text-sm font-semibold mb-2">Service (£):</label>
                            <div class="flex space-x-2">
                                <input type="number" id="car1_service" value="200" min="0" class="input-field" oninput="calculateOutgoings()">
                                <select id="car1_service_freq" class="select-field w-auto" onchange="calculateOutgoings()">
                                    <option value="annually">Annually</option>
                                    <option value="monthly">Monthly</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label for="car1_insurance" class="block text-gray-700 text-sm font-semibold mb-2">Car Insurance (£):</label>
                            <div class="flex space-x-2">
                                <input type="number" id="car1_insurance" value="50" min="0" class="input-field" oninput="calculateOutgoings()">
                                <select id="car1_insurance_freq" class="select-field w-auto" onchange="calculateOutgoings()">
                                    <option value="monthly">Monthly</option>
                                    <option value="annually">Annually</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Car 2: Estate -->
                <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
                    <h3 class="category-heading">Car 2: Estate</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="car2_fuel" class="block text-gray-700 text-sm font-semibold mb-2">Fuel (£):</label>
                            <div class="flex space-x-2">
                                <input type="number" id="car2_fuel" value="100" min="0" class="input-field" oninput="calculateOutgoings()">
                                <select id="car2_fuel_freq" class="select-field w-auto" onchange="calculateOutgoings()">
                                    <option value="monthly">Monthly</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label for="car2_tax" class="block text-gray-700 text-sm font-semibold mb-2">Car Tax (£):</label>
                            <div class="flex space-x-2">
                                <input type="number" id="car2_tax" value="150" min="0" class="input-field" oninput="calculateOutgoings()">
                                <select id="car2_tax_freq" class="select-field w-auto" onchange="calculateOutgoings()">
                                    <option value="annually">Annually</option>
                                    <option value="monthly">Monthly</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label for="car2_mot" class="block text-gray-700 text-sm font-semibold mb-2">MOT (£):</label>
                            <div class="flex space-x-2">
                                <input type="number" id="car2_mot" value="50" min="0" class="input-field" oninput="calculateOutgoings()">
                                <select id="car2_mot_freq" class="select-field w-auto" onchange="calculateOutgoings()">
                                    <option value="annually">Annually</option>
                                    <option value="monthly">Monthly</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label for="car2_service" class="block text-gray-700 text-sm font-semibold mb-2">Service (£):</label>
                            <div class="flex space-x-2">
                                <input type="number" id="car2_service" value="180" min="0" class="input-field" oninput="calculateOutgoings()">
                                <select id="car2_service_freq" class="select-field w-auto" onchange="calculateOutgoings()">
                                    <option value="annually">Annually</option>
                                    <option value="monthly">Monthly</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label for="car2_insurance" class="block text-gray-700 text-sm font-semibold mb-2">Car Insurance (£):</label>
                            <div class="flex space-x-2">
                                <input type="number" id="car2_insurance" value="45" min="0" class="input-field" oninput="calculateOutgoings()">
                                <select id="car2_insurance_freq" class="select-field w-auto" onchange="calculateOutgoings()">
                                    <option value="monthly">Monthly</option>
                                    <option value="annually">Annually</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Professional Expenses -->
                <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
                    <h3 class="category-heading">Professional Expenses</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="prof_bma" class="block text-gray-700 text-sm font-semibold mb-2">BMA (£):</label>
                            <div class="flex space-x-2">
                                <input type="number" id="prof_bma" value="25" min="0" class="input-field" oninput="calculateOutgoings()">
                                <select id="prof_bma_freq" class="select-field w-auto" onchange="calculateOutgoings()">
                                    <option value="monthly">Monthly</option>
                                    <option value="annually">Annually</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label for="prof_rcog" class="block text-gray-700 text-sm font-semibold mb-2">RCOG (£):</label>
                            <div class="flex space-x-2">
                                <input type="number" id="prof_rcog" value="50" min="0" class="input-field" oninput="calculateOutgoings()">
                                <select id="prof_rcog_freq" class="select-field w-auto" onchange="calculateOutgoings()">
                                    <option value="monthly">Monthly</option>
                                    <option value="annually">Annually</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label for="prof_gmc" class="block text-gray-700 text-sm font-semibold mb-2">GMC (£):</label>
                            <div class="flex space-x-2">
                                <input type="number" id="prof_gmc" value="30" min="0" class="input-field" oninput="calculateOutgoings()">
                                <select id="prof_gmc_freq" class="select-field w-auto" onchange="calculateOutgoings()">
                                    <option value="monthly">Monthly</option>
                                    <option value="annually">Annually</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label for="prof_mdu" class="block text-gray-700 text-sm font-semibold mb-2">MDU (£):</label>
                            <div class="flex space-x-2">
                                <input type="number" id="prof_mdu" value="40" min="0" class="input-field" oninput="calculateOutgoings()">
                                <select id="prof_mdu_freq" class="select-field w-auto" onchange="calculateOutgoings()">
                                    <option value="monthly">Monthly</option>
                                    <option value="annually">Annually</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label for="prof_nmc" class="block text-gray-700 text-sm font-semibold mb-2">NMC (£):</label>
                            <div class="flex space-x-2">
                                <input type="number" id="prof_nmc" value="10" min="0" class="input-field" oninput="calculateOutgoings()">
                                <select id="prof_nmc_freq" class="select-field w-auto" onchange="calculateOutgoings()">
                                    <option value="monthly">Monthly</option>
                                    <option value="annually">Annually</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label for="prof_rcn" class="block text-gray-700 text-sm font-semibold mb-2">RCN (£):</label>
                            <div class="flex space-x-2">
                                <input type="number" id="prof_rcn" value="15" min="0" class="input-field" oninput="calculateOutgoings()">
                                <select id="prof_rcn_freq" class="select-field w-auto" onchange="calculateOutgoings()">
                                    <option value="monthly">Monthly</option>
                                    <option value="annually">Annually</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Dora (Dog Expenses) -->
                <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
                    <h3 class="category-heading">Dora (Dog Expenses)</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="dora_dogWalker" class="block text-gray-700 text-sm font-semibold mb-2">Dog Walker (£):</label>
                            <div class="flex space-x-2">
                                <input type="number" id="dora_dogWalker" value="100" min="0" class="input-field" oninput="calculateOutgoings()">
                                <select id="dora_dogWalker_freq" class="select-field w-auto" onchange="calculateOutgoings()">
                                    <option value="monthly">Monthly</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label for="dora_vaccines" class="block text-gray-700 text-sm font-semibold mb-2">Vaccines (£):</label>
                            <div class="flex space-x-2">
                                <input type="number" id="dora_vaccines" value="80" min="0" class="input-field" oninput="calculateOutgoings()">
                                <select id="dora_vaccines_freq" class="select-field w-auto" onchange="calculateOutgoings()">
                                    <option value="annually">Annually</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label for="dora_foodTreats" class="block text-gray-700 text-sm font-semibold mb-2">Food & Treats (£):</label>
                            <div class="flex space-x-2">
                                <input type="number" id="dora_foodTreats" value="50" min="0" class="input-field" oninput="calculateOutgoings()">
                                <select id="dora_foodTreats_freq" class="select-field w-auto" onchange="calculateOutgoings()">
                                    <option value="monthly">Monthly</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label for="dora_grooming" class="block text-gray-700 text-sm font-semibold mb-2">Grooming (£):</label>
                            <div class="flex space-x-2">
                                <input type="number" id="dora_grooming" value="30" min="0" class="input-field" oninput="calculateOutgoings()">
                                <select id="dora_grooming_freq" class="select-field w-auto" onchange="calculateOutgoings()">
                                    <option value="quarterly">Quarterly</option>
                                    <option value="monthly">Monthly</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Subscriptions -->
                <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
                    <h3 class="category-heading">Subscriptions</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="subscriptions_netflix" class="block text-gray-700 text-sm font-semibold mb-2">Netflix (£):</label>
                            <div class="flex space-x-2">
                                <input type="number" id="subscriptions_netflix" value="15" min="0" class="input-field" oninput="calculateOutgoings()">
                                <select id="subscriptions_netflix_freq" class="select-field w-auto" onchange="calculateOutgoings()">
                                    <option value="monthly">Monthly</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label for="subscriptions_amazonPrime" class="block text-gray-700 text-sm font-semibold mb-2">Amazon Prime (£):</label>
                            <div class="flex space-x-2">
                                <input type="number" id="subscriptions_amazonPrime" value="9" min="0" class="input-field" oninput="calculateOutgoings()">
                                <select id="subscriptions_amazonPrime_freq" class="select-field w-auto" onchange="calculateOutgoings()">
                                    <option value="monthly">Monthly</option>
                                    <option value="annually">Annually</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label for="subscriptions_disneyPlus" class="block text-gray-700 text-sm font-semibold mb-2">Disney+ (£):</label>
                            <div class="flex space-x-2">
                                <input type="number" id="subscriptions_disneyPlus" value="8" min="0" class="input-field" oninput="calculateOutgoings()">
                                <select id="subscriptions_disneyPlus_freq" class="select-field w-auto" onchange="calculateOutgoings()">
                                    <option value="monthly">Monthly</option>
                                    <option value="annually">Annually</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label for="subscriptions_other" class="block text-gray-700 text-sm font-semibold mb-2">Other Subscriptions (£):</label>
                            <div class="flex space-x-2">
                                <input type="number" id="subscriptions_other" value="0" min="0" class="input-field" oninput="calculateOutgoings()">
                                <select id="subscriptions_other_freq" class="select-field w-auto" onchange="calculateOutgoings()">
                                    <option value="monthly">Monthly</option>
                                    <option value="quarterly">Quarterly</option>
                                    <option value="annually">Annually</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Debt -->
                <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
                    <h3 class="category-heading">Debt Repayments</h3>
                    <div id="debt-items-container" class="space-y-4 mb-4">
                        <!-- Default Debt Item -->
                        <div class="debt-item flex flex-col md:flex-row items-start md:items-center gap-2">
                            <input type="text" placeholder="e.g., Credit Card" value="Credit Card" class="input-field flex-grow" aria-label="Debt Name">
                            <input type="number" value="100" min="0" class="input-field w-24" oninput="calculateOutgoings()" aria-label="Debt Amount">
                            <select class="select-field w-auto" onchange="calculateOutgoings()" aria-label="Debt Frequency">
                                <option value="monthly">Monthly</option>
                                <option value="quarterly">Quarterly</option>
                                <option value="annually">Annually</option>
                            </select>
                            <button onclick="removeDebtItem(this)" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-3 rounded-lg shadow-sm transition duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-75 flex-shrink-0">
                                Delete
                            </button>
                        </div>
                    </div>
                    <button onclick="addDebtItem()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-75">
                        Add New Debt
                    </button>
                </div>

                <!-- Savings -->
                <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
                    <h3 class="category-heading">Savings</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="savings_children" class="block text-gray-700 text-sm font-semibold mb-2">Children's Savings (£):</label>
                            <div class="flex space-x-2">
                                <input type="number" id="savings_children" value="50" min="0" class="input-field" oninput="calculateOutgoings()">
                                <select id="savings_children_freq" class="select-field w-auto" onchange="calculateOutgoings()">
                                    <option value="monthly">Monthly</option>
                                    <option value="annually">Annually</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label for="savings_sands" class="block text-gray-700 text-sm font-semibold mb-2">S&S ISA (£):</label>
                            <div class="flex space-x-2">
                                <input type="number" id="savings_sands" value="100" min="0" class="input-field" oninput="calculateOutgoings()">
                                <select id="savings_sands_freq" class="select-field w-auto" onchange="calculateOutgoings()">
                                    <option value="monthly">Monthly</option>
                                    <option value="annually">Annually</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label for="savings_james" class="block text-gray-700 text-sm font-semibold mb-2">James's Savings (£):</label>
                            <div class="flex space-x-2">
                                <input type="number" id="savings_james" value="0" min="0" class="input-field" oninput="calculateOutgoings()">
                                <select id="savings_james_freq" class="select-field w-auto" onchange="calculateOutgoings()">
                                    <option value="monthly">Monthly</option>
                                    <option value="annually">Annually</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label for="savings_other" class="block text-gray-700 text-sm font-semibold mb-2">Other Savings (£):</label>
                            <div class="flex space-x-2">
                                <input type="number" id="savings_other" value="0" min="0" class="input-field" oninput="calculateOutgoings()">
                                <select id="savings_other_freq" class="select-field w-auto" onchange="calculateOutgoings()">
                                    <option value="monthly">Monthly</option>
                                    <option value="quarterly">Quarterly</option>
                                    <option value="annually">Annually</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Other Expenses -->
                <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
                    <h3 class="category-heading">Other Expenses</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="other_nationalTrust" class="block text-gray-700 text-sm font-semibold mb-2">National Trust (£):</label>
                            <div class="flex space-x-2">
                                <input type="number" id="other_nationalTrust" value="10" min="0" class="input-field" oninput="calculateOutgoings()">
                                <select id="other_nationalTrust_freq" class="select-field w-auto" onchange="calculateOutgoings()">
                                    <option value="monthly">Monthly</option>
                                    <option value="annually">Annually</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label for="other_miscellaneous" class="block text-gray-700 text-sm font-semibold mb-2">Miscellaneous (£):</label>
                            <div class="flex space-x-2">
                                <input type="number" id="other_miscellaneous" value="50" min="0" class="input-field" oninput="calculateOutgoings()">
                                <select id="other_miscellaneous_freq" class="select-field w-auto" onchange="calculateOutgoings()">
                                    <option value="monthly">Monthly</option>
                                    <option value="quarterly">Quarterly</option>
                                    <option value="annually">Annually</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Monthly Costs Summary -->
            <div class="bg-gray-100 p-4 rounded-lg mb-6 border border-gray-200">
                <h3 class="text-lg font-semibold text-gray-800 mb-3">Monthly Costs Summary</h3>
                <div class="space-y-1 text-gray-700">
                    <p><strong>Housing:</strong> <span id="summary_housing" class="font-medium"></span></p>
                    <p><strong>Services:</strong> <span id="summary_services" class="font-medium"></span></p>
                    <p><strong>Car 1 (Leon):</strong> <span id="summary_car1" class="font-medium"></span></p>
                    <p><strong>Car 2 (Estate):</strong> <span id="summary_car2" class="font-medium"></span></p>
                    <p><strong>Professional Expenses:</strong> <span id="summary_professionalExpenses" class="font-medium"></span></p>
                    <p><strong>Dora (Dog Expenses):</strong> <span id="summary_dora" class="font-medium"></span></p>
                    <p><strong>Subscriptions:</strong> <span id="summary_subscriptions" class="font-medium"></span></p>
                    <p><strong>Debt Repayments:</strong> <span id="summary_debt" class="font-medium"></span></p>
                    <p><strong>Savings:</strong> <span id="summary_savings" class="font-medium"></span></p>
                    <p><strong>Other Expenses:</strong> <span id="summary_other" class="font-medium"></span></p>
                    <p class="pt-2 border-t border-gray-300"><strong>Total Monthly Outgoings:</strong> <span id="totalMonthlyOutgoings" class="font-bold text-red-600 text-lg"></span></p>
                </div>
            </div>

            <div class="bg-green-50 p-4 rounded-lg mb-6">
                <h3 class="text-lg font-semibold text-green-800 mb-3">Overall Budget Summary:</h3>
                <p><strong>Total Annual Outgoings:</strong> <span id="totalAnnualOutgoings" class="font-medium text-red-600"></span></p>
                <p class="pt-2 border-t border-green-200"><strong>Monthly Money Left:</strong> <span id="moneyLeftMonthly" class="font-bold text-green-700 text-xl"></span></p>
                <p><strong>Annual Money Left:</strong> <span id="moneyLeftAnnual" class="font-bold text-green-700 text-xl"></span></p>
            </div>

            <button onclick="showPage('page-calculator')"
                    class="w-full bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-4 rounded-lg shadow-md transition duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-75">
                Back to Calculator
            </button>
        </div>

        <div class="text-sm text-gray-600 mt-6">
            <p>
                * Calculations are based on the selected UK tax year rates.
            </p>
            <p>
                * NHS Pension contribution rates are tiered based on your pensionable pay (gross income minus salary sacrifice).
            </p>
            <p>
                * Personal Allowance tapering applies for incomes over £100,000.
            </p>
            <p>
                * SIPP contributions are assumed to be made from net pay, with basic rate tax relief (20%) added by the provider, and higher/additional rate relief claimed separately from HMRC.
            </p>
            <p>
                * **Disclaimer:** This calculator provides an estimate based on current publicly available information and typical deductions. It does not account for all individual circumstances (e.g., specific tax codes, other allowances, student loans, or unusual deductions). Always consult with a financial advisor for personalized advice.
            </p>
        </div>
    </div>

    <script>
        // Global variables to store net pay for transfer between pages
        let globalMonthlyNetPay = 0;
        let globalAnnualNetPay = 0;

        // Function to format numbers as currency
        function formatCurrency(amount) {
            return `£${amount.toFixed(2)}`;
        }

        // Data for different tax years
        const taxYearData = {
            "2024/2025": {
                personalAllowance: 12570,
                incomeTaxBands: [
                    { threshold: 0, rate: 0.20, name: "Basic Rate" },
                    { threshold: 37701, rate: 0.40, name: "Higher Rate" },
                    { threshold: 125141, rate: 0.45, name: "Additional Rate" }
                ],
                niThresholds: [
                    { threshold: 0, rate: 0.00, name: "Primary Threshold" },
                    { threshold: 12571, rate: 0.08, name: "Main Rate" },
                    { threshold: 50271, rate: 0.02, name: "Upper Earnings Limit" }
                ],
                nhsPensionTiers: [
                    { threshold: 0, rate: 0.052 },        // Up to £13,246
                    { threshold: 13247, rate: 0.065 },    // £13,247 to £26,117
                    { threshold: 26118, rate: 0.071 },    // £26,118 to £32,606
                    { threshold: 32607, rate: 0.076 },    // £32,607 to £39,095
                    { threshold: 39096, rate: 0.083 },    // £39,096 to £45,584
                    { threshold: 45585, rate: 0.092 },    // £45,585 to £50,974
                    { threshold: 50975, rate: 0.100 },    // £50,975 to £56,363
                    { threshold: 56364, rate: 0.116 },    // £56,364 to £70,454
                    { threshold: 70455, rate: 0.125 },    // £70,455 to £111,376
                    { threshold: 111377, rate: 0.135 }    // £111,377 and above
                ]
            },
            "2025/2026": {
                // Assuming same rates as 2024/2025 for now as official 25/26 NHS pension tiers
                // and any other potential changes might not be fully released or finalized.
                // Tax and NI rates are confirmed to be the same as 24/25.
                personalAllowance: 12570,
                incomeTaxBands: [
                    { threshold: 0, rate: 0.20, name: "Basic Rate" },
                    { threshold: 37701, rate: 0.40, name: "Higher Rate" },
                    { threshold: 125141, rate: 0.45, name: "Additional Rate" }
                ],
                niThresholds: [
                    { threshold: 0, rate: 0.00, name: "Primary Threshold" },
                    { threshold: 12571, rate: 0.08, name: "Main Rate" },
                    { threshold: 50271, rate: 0.02, name: "Upper Earnings Limit" }
                ],
                nhsPensionTiers: [
                    { threshold: 0, rate: 0.052 },        // Up to £13,246
                    { threshold: 13247, rate: 0.065 },    // £13,247 to £26,117
                    { threshold: 26118, rate: 0.071 },    // £26,118 to £32,606
                    { threshold: 32607, rate: 0.076 },    // £32,607 to £39,095
                    { threshold: 39096, rate: 0.083 },    // £39,096 to £45,584
                    { threshold: 45585, rate: 0.092 },    // £45,585 to £50,974
                    { threshold: 50975, rate: 0.100 },    // £50,975 to £56,363
                    { threshold: 56364, rate: 0.116 },    // £56,364 to £70,454
                    { threshold: 70455, rate: 0.125 },    // £70,455 to £111,376
                    { threshold: 111377, rate: 0.135 }    // £111,377 and above
                ]
            }
        };


        /**
         * Converts an amount from a given frequency to its monthly equivalent.
         * @param {number} amount - The amount to convert.
         * @param {string} frequency - The frequency ('monthly', 'quarterly', 'annually').
         * @returns {number} The monthly equivalent amount.
         */
        function convertToMonthly(amount, frequency) {
            switch (frequency) {
                case 'monthly':
                    return amount;
                case 'quarterly':
                    return amount / 3;
                case 'annually':
                    return amount / 12;
                default:
                    return amount; // Default to monthly if frequency is unknown
            }
        }

        /**
         * Calculates the NHS Pension contribution rate based on annual pensionable pay
         * and the selected tax year's tiers.
         * @param {number} pensionablePay - The annual income used for pension calculation (gross minus salary sacrifice).
         * @param {string} taxYear - The selected tax year (e.g., "2024/2025").
         * @returns {object} An object containing the rate and the applicable tier name.
         */
        function getNhsPensionRate(pensionablePay, taxYear) {
            const tiers = taxYearData[taxYear].nhsPensionTiers;

            for (let i = tiers.length - 1; i >= 0; i--) {
                if (pensionablePay >= tiers[i].threshold) {
                    const nextThreshold = (i + 1 < tiers.length) ? tiers[i+1].threshold -1 : 'and above';
                    const tierName = `Tier: £${tiers[i].threshold.toLocaleString()} to £${nextThreshold.toLocaleString()} (${(tiers[i].rate * 100).toFixed(1)}%)`;
                    return { rate: tiers[i].rate, name: tierName };
                }
            }
            // Default to the lowest rate if somehow below the first threshold
            return { rate: tiers[0].rate, name: `Tier: Up to £${tiers[0].threshold.toLocaleString()} (${(tiers[0].rate * 100).toFixed(1)}%)` };
        }


        function calculatePay() {
            const selectedTaxYear = document.getElementById('taxYear').value;
            const currentTaxYearData = taxYearData[selectedTaxYear];

            const baseAnnualSalary = parseFloat(document.getElementById('baseSalaryAnnual').value) || 0;
            const locumHourlyRate = parseFloat(document.getElementById('locumRate').value) || 0;
            const locumHoursPerMonth = parseFloat(document.getElementById('locumHours').value) || 0;
            const monthlySalarySacrifice = parseFloat(document.getElementById('salarySacrificeMonthly').value) || 0;
            const monthlySIPPContribution = parseFloat(document.getElementById('monthlySIPPContribution').value) || 0;

            // Calculate annual equivalents from monthly inputs
            const annualLocumIncome = locumHoursPerMonth * locumHourlyRate * 12;
            const annualSalarySacrifice = monthlySalarySacrifice * 12;
            const annualSIPPContribution = monthlySIPPContribution * 12; // Calculate annual SIPP from monthly input

            // Calculate total gross annual income (before salary sacrifice)
            const grossAnnualIncomeBeforeSacrifice = baseAnnualSalary + annualLocumIncome;

            // Effective gross income after salary sacrifice, for pension/tax/NI calculations
            const effectiveGrossIncome = grossAnnualIncomeBeforeSacrifice - annualSalarySacrifice;

            if (isNaN(effectiveGrossIncome) || effectiveGrossIncome < 0) {
                // Clear all results if input is invalid
                document.getElementById('annualGross').textContent = '';
                document.getElementById('monthlyGross').textContent = '';
                document.getElementById('annualPension').textContent = '';
                document.getElementById('monthlyPension').textContent = '';
                document.getElementById('pensionRateDetail').textContent = '';
                document.getElementById('annualSalarySacrifice').textContent = '';
                document.getElementById('monthlySalarySacrifice').textContent = '';
                document.getElementById('annualSIPPContributionDisplay').textContent = '';
                document.getElementById('monthlySIPPContributionDisplay').textContent = '';
                document.getElementById('sippTaxReliefDetail').innerHTML = '';
                document.getElementById('annualSIPP_TaxRelief').textContent = '';
                document.getElementById('monthlySIPP_TaxRelief').textContent = '';
                document.getElementById('annualTax').textContent = '';
                document.getElementById('monthlyTax').textContent = '';
                document.getElementById('taxBreakdown').innerHTML = '';
                document.getElementById('annualNI').textContent = '';
                document.getElementById('monthlyNI').textContent = '';
                document.getElementById('niBreakdown').innerHTML = '';
                document.getElementById('annualPALost').textContent = '';
                document.getElementById('monthlyPALost').textContent = '';
                document.getElementById('monthlyNet').textContent = '';
                document.getElementById('annualNet').textContent = '';

                // Also clear global net pay
                globalMonthlyNetPay = 0;
                globalAnnualNetPay = 0;
                return;
            }

            // --- Annual Calculations ---

            // 1. Pension Contribution (based on tiered rate)
            const pensionDetails = getNhsPensionRate(effectiveGrossIncome, selectedTaxYear);
            const annualPensionContribution = effectiveGrossIncome * pensionDetails.rate;

            // 2. Adjusted Net Income (ANI) for Personal Allowance and Tax Calculation
            // This is effectiveGrossIncome minus pension contributions.
            const adjustedNetIncome = effectiveGrossIncome - annualPensionContribution;

            // 3. Personal Allowance (PA)
            const standardPersonalAllowance = currentTaxYearData.personalAllowance; // Store original PA
            let personalAllowance = standardPersonalAllowance;
            let annualPersonalAllowanceLost = 0; // Initialize lost amount

            if (adjustedNetIncome > 100000) {
                const paReduction = (adjustedNetIncome - 100000) / 2;
                personalAllowance = Math.max(0, personalAllowance - paReduction);
                annualPersonalAllowanceLost = standardPersonalAllowance - personalAllowance; // Calculate lost amount
            }

            // 4. Taxable Income (income after PA and pension/salary sacrifice deductions)
            let taxableIncome = Math.max(0, adjustedNetIncome - personalAllowance);

            // 5. Income Tax Calculation (based on selected tax year's UK rates)
            let annualIncomeTax = 0;
            let taxBreakdownHtml = '';
            let incomeToTax = taxableIncome; // This is the income *after* PA

            // Basic Rate Band (20%)
            const basicRateThreshold = currentTaxYearData.incomeTaxBands[0].threshold; // 0
            const higherRateThreshold = currentTaxYearData.incomeTaxBands[1].threshold; // 37701
            const additionalRateThreshold = currentTaxYearData.incomeTaxBands[2].threshold; // 125141

            const basicRate = currentTaxYearData.incomeTaxBands[0].rate;
            const higherRate = currentTaxYearData.incomeTaxBands[1].rate;
            const additionalRate = currentTaxYearData.incomeTaxBands[2].rate;

            // Tax on Basic Rate Band
            const taxedAtBasicRate = Math.min(incomeToTax, higherRateThreshold - basicRateThreshold);
            if (taxedAtBasicRate > 0) {
                const tax = taxedAtBasicRate * basicRate;
                annualIncomeTax += tax;
                taxBreakdownHtml += `<p>£${taxedAtBasicRate.toFixed(2)} at ${(basicRate * 100).toFixed(0)}% (${currentTaxYearData.incomeTaxBands[0].name}): ${formatCurrency(tax)}</p>`;
                incomeToTax -= taxedAtBasicRate;
            }

            // Tax on Higher Rate Band
            if (incomeToTax > 0) {
                const taxedAtHigherRate = Math.min(incomeToTax, additionalRateThreshold - higherRateThreshold);
                if (taxedAtHigherRate > 0) {
                    const tax = taxedAtHigherRate * higherRate;
                    annualIncomeTax += tax;
                    taxBreakdownHtml += `<p>£${taxedAtHigherRate.toFixed(2)} at ${(higherRate * 100).toFixed(0)}% (${currentTaxYearData.incomeTaxBands[1].name}): ${formatCurrency(tax)}</p>`;
                    incomeToTax -= taxedAtHigherRate;
                }
            }

            // Tax on Additional Rate Band
            if (incomeToTax > 0) {
                const taxedAtAdditionalRate = incomeToTax; // All remaining income
                const tax = taxedAtAdditionalRate * additionalRate;
                annualIncomeTax += tax;
                taxBreakdownHtml += `<p>£${taxedAtAdditionalRate.toFixed(2)} at ${(additionalRate * 100).toFixed(0)}% (${currentTaxYearData.incomeTaxBands[2].name}): ${formatCurrency(tax)}</p>`;
            }


            // 6. National Insurance (NI) Calculation (based on selected tax year's UK rates)
            // NI is calculated on effective gross income (after salary sacrifice).
            let annualNationalInsurance = 0;
            let niBreakdownHtml = '';
            let earningsForNI = effectiveGrossIncome; // Income for NI calculation

            const niPrimaryThreshold = currentTaxYearData.niThresholds[0].threshold; // 0
            const niMainRateStart = currentTaxYearData.niThresholds[1].threshold; // 12571
            const niUELStart = currentTaxYearData.niThresholds[2].threshold; // 50271

            const niMainRate = currentTaxYearData.niThresholds[1].rate;
            const niUELRate = currentTaxYearData.niThresholds[2].rate;

            // NI on Main Rate Band (8%)
            // Earnings between niMainRateStart and niUELStart
            const earningsInMainNI = Math.min(Math.max(0, earningsForNI - niMainRateStart + 1), niUELStart - niMainRateStart);
            if (earningsInMainNI > 0) {
                const ni = earningsInMainNI * niMainRate;
                annualNationalInsurance += ni;
                niBreakdownHtml += `<p>£${earningsInMainNI.toFixed(2)} at ${(niMainRate * 100).toFixed(0)}% (${currentTaxYearData.niThresholds[1].name}): ${formatCurrency(ni)}</p>`;
            }

            // NI on Upper Earnings Limit Band (2%)
            // Earnings above niUELStart
            const earningsInUELNI = Math.max(0, earningsForNI - niUELStart + 1);
            if (earningsInUELNI > 0) {
                const ni = earningsInUELNI * niUELRate;
                annualNationalInsurance += ni;
                niBreakdownHtml += `<p>£${earningsInUELNI.toFixed(2)} at ${(niUELRate * 100).toFixed(0)}% (${currentTaxYearData.niThresholds[2].name}): ${formatCurrency(ni)}</p>`;
            }


            // 7. SIPP Tax Relief Calculation
            let additionalSIPP_TaxRelief = 0;
            let sippGrossContribution = 0;
            let sippTaxReliefDetailHtml = '';

            if (annualSIPPContribution > 0) {
                sippGrossContribution = annualSIPPContribution / 0.8; // Gross up by basic rate relief (20%)

                // Determine marginal tax rate based on adjustedNetIncome
                let marginalTaxRateForSIPP = 0.20; // Default to basic rate
                if (adjustedNetIncome > additionalRateThreshold -1) { // If income hits additional rate band
                    marginalTaxRateForSIPP = 0.45;
                } else if (adjustedNetIncome > higherRateThreshold -1) { // If income hits higher rate band
                    marginalTaxRateForSIPP = 0.40;
                }

                additionalSIPP_TaxRelief = sippGrossContribution * (marginalTaxRateForSIPP - 0.20);

                sippTaxReliefDetailHtml = `<p>Gross SIPP Contribution: ${formatCurrency(sippGrossContribution)}</p>`;
                if (marginalTaxRateForSIPP > 0.20) {
                    sippTaxReliefDetailHtml += `<p>Additional tax relief claimed from HMRC: ${formatCurrency(additionalSIPP_TaxRelief)} (at ${(marginalTaxRateForSIPP * 100).toFixed(0)}% - 20%)</p>`;
                } else {
                    sippTaxReliefDetailHtml += `<p>Basic rate tax relief (20%) already added by provider.</p>`;
                }
            }


            // 8. Annual Take-Home Pay
            // This is the original gross minus all deductions, PLUS SIPP tax relief.
            const annualTakeHomePay = grossAnnualIncomeBeforeSacrifice
                                     - annualPensionContribution
                                     - annualIncomeTax
                                     - annualNationalInsurance
                                     - annualSalarySacrifice
                                     - annualSIPPContribution // Net amount paid by user
                                     + additionalSIPP_TaxRelief; // Additional relief from HMRC

            // --- Monthly Conversions for Display ---
            const monthlyGross = grossAnnualIncomeBeforeSacrifice / 12;
            const monthlyPension = annualPensionContribution / 12;
            const monthlyTax = annualIncomeTax / 12;
            const monthlyNI = annualNationalInsurance / 12;
            const monthlyPersonalAllowanceLost = annualPersonalAllowanceLost / 12;
            // monthlySIPPContribution is already monthly from input
            const monthlySIPP_TaxRelief = additionalSIPP_TaxRelief / 12;

            const monthlyNet = annualTakeHomePay / 12;

            // --- Store net pay globally for the outgoings page ---
            globalMonthlyNetPay = monthlyNet;
            globalAnnualNetPay = annualTakeHomePay;


            // --- Display Results ---
            document.getElementById('annualGross').textContent = formatCurrency(grossAnnualIncomeBeforeSacrifice);
            document.getElementById('monthlyGross').textContent = formatCurrency(monthlyGross);

            document.getElementById('annualPension').textContent = formatCurrency(annualPensionContribution);
            document.getElementById('monthlyPension').textContent = formatCurrency(monthlyPension);
            document.getElementById('pensionRateDetail').textContent = `(Applied rate: ${pensionDetails.name})`;

            document.getElementById('annualSalarySacrifice').textContent = formatCurrency(annualSalarySacrifice);
            document.getElementById('monthlySalarySacrifice').textContent = formatCurrency(monthlySalarySacrifice);

            // Display for SIPP contributions
            document.getElementById('annualSIPPContributionDisplay').textContent = formatCurrency(annualSIPPContribution);
            document.getElementById('monthlySIPPContributionDisplay').textContent = formatCurrency(monthlySIPPContribution);
            document.getElementById('sippTaxReliefDetail').innerHTML = sippTaxReliefDetailHtml;
            document.getElementById('annualSIPP_TaxRelief').textContent = formatCurrency(additionalSIPP_TaxRelief);
            document.getElementById('monthlySIPP_TaxRelief').textContent = formatCurrency(monthlySIPP_TaxRelief);

            document.getElementById('annualTax').textContent = formatCurrency(annualIncomeTax);
            document.getElementById('monthlyTax').textContent = formatCurrency(monthlyTax);
            document.getElementById('taxBreakdown').innerHTML = taxBreakdownHtml;

            document.getElementById('annualNI').textContent = formatCurrency(annualNationalInsurance);
            document.getElementById('monthlyNI').textContent = formatCurrency(monthlyNI);
            document.getElementById('niBreakdown').innerHTML = niBreakdownHtml;

            document.getElementById('annualPALost').textContent = formatCurrency(annualPersonalAllowanceLost);
            document.getElementById('monthlyPALost').textContent = formatCurrency(monthlyPersonalAllowanceLost);

            document.getElementById('monthlyNet').textContent = formatCurrency(monthlyNet);
            document.getElementById('annualNet').textContent = formatCurrency(annualTakeHomePay);
        }

        /**
         * Calculates total outgoings and remaining money.
         */
        function calculateOutgoings() {
            let totalMonthlyOutgoings = 0;
            let monthlyCategoryTotals = {
                housing: 0,
                services: 0,
                car1: 0, // Car 1 specific total
                car2: 0, // Car 2 specific total
                professionalExpenses: 0, // New category
                dora: 0, // New category
                subscriptions: 0,
                debt: 0,
                savings: 0,
                other: 0 // New category
            };

            // Helper to get value and convert to monthly
            const getMonthlyValue = (id, freqId) => {
                const amount = parseFloat(document.getElementById(id).value) || 0;
                const frequency = document.getElementById(freqId).value;
                return convertToMonthly(amount, frequency);
            };

            // Housing
            monthlyCategoryTotals.housing += getMonthlyValue('housing_mortgageRent', 'housing_mortgageRent_freq');
            monthlyCategoryTotals.housing += getMonthlyValue('housing_councilTax', 'housing_councilTax_freq');
            monthlyCategoryTotals.housing += getMonthlyValue('housing_houseInsurance', 'housing_houseInsurance_freq');
            monthlyCategoryTotals.housing += getMonthlyValue('housing_maintenance', 'housing_maintenance_freq'); // New item

            // Services
            monthlyCategoryTotals.services += getMonthlyValue('services_octopus', 'services_octopus_freq');
            monthlyCategoryTotals.services += getMonthlyValue('services_severnTrent', 'services_severnTrent_freq');
            monthlyCategoryTotals.services += getMonthlyValue('services_phoneInternet', 'services_phoneInternet_freq');
            monthlyCategoryTotals.services += getMonthlyValue('services_streamingTV', 'services_streamingTV_freq');
            monthlyCategoryTotals.services += getMonthlyValue('services_other', 'services_other_freq');

            // Car 1 (Leon)
            monthlyCategoryTotals.car1 += getMonthlyValue('car1_fuel', 'car1_fuel_freq');
            monthlyCategoryTotals.car1 += getMonthlyValue('car1_tax', 'car1_tax_freq');
            monthlyCategoryTotals.car1 += getMonthlyValue('car1_mot', 'car1_mot_freq');
            monthlyCategoryTotals.car1 += getMonthlyValue('car1_service', 'car1_service_freq');
            monthlyCategoryTotals.car1 += getMonthlyValue('car1_insurance', 'car1_insurance_freq');

            // Car 2 (Estate)
            monthlyCategoryTotals.car2 += getMonthlyValue('car2_fuel', 'car2_fuel_freq');
            monthlyCategoryTotals.car2 += getMonthlyValue('car2_tax', 'car2_tax_freq');
            monthlyCategoryTotals.car2 += getMonthlyValue('car2_mot', 'car2_mot_freq');
            monthlyCategoryTotals.car2 += getMonthlyValue('car2_service', 'car2_service_freq');
            monthlyCategoryTotals.car2 += getMonthlyValue('car2_insurance', 'car2_insurance_freq');

            // Professional Expenses
            monthlyCategoryTotals.professionalExpenses += getMonthlyValue('prof_bma', 'prof_bma_freq');
            monthlyCategoryTotals.professionalExpenses += getMonthlyValue('prof_rcog', 'prof_rcog_freq');
            monthlyCategoryTotals.professionalExpenses += getMonthlyValue('prof_gmc', 'prof_gmc_freq');
            monthlyCategoryTotals.professionalExpenses += getMonthlyValue('prof_mdu', 'prof_mdu_freq');
            monthlyCategoryTotals.professionalExpenses += getMonthlyValue('prof_nmc', 'prof_nmc_freq');
            monthlyCategoryTotals.professionalExpenses += getMonthlyValue('prof_rcn', 'prof_rcn_freq');

            // Dora (Dog Expenses)
            monthlyCategoryTotals.dora += getMonthlyValue('dora_dogWalker', 'dora_dogWalker_freq');
            monthlyCategoryTotals.dora += getMonthlyValue('dora_vaccines', 'dora_vaccines_freq');
            monthlyCategoryTotals.dora += getMonthlyValue('dora_foodTreats', 'dora_foodTreats_freq');
            monthlyCategoryTotals.dora += getMonthlyValue('dora_grooming', 'dora_grooming_freq');

            // Subscriptions
            monthlyCategoryTotals.subscriptions += getMonthlyValue('subscriptions_netflix', 'subscriptions_netflix_freq');
            monthlyCategoryTotals.subscriptions += getMonthlyValue('subscriptions_amazonPrime', 'subscriptions_amazonPrime_freq');
            monthlyCategoryTotals.subscriptions += getMonthlyValue('subscriptions_disneyPlus', 'subscriptions_disneyPlus_freq');
            monthlyCategoryTotals.subscriptions += getMonthlyValue('subscriptions_other', 'subscriptions_other_freq');

            // Debt (dynamic)
            document.querySelectorAll('#debt-items-container .debt-item').forEach(item => {
                const amountInput = item.querySelector('input[type="number"]');
                const freqSelect = item.querySelector('select');
                if (amountInput && freqSelect) {
                    monthlyCategoryTotals.debt += convertToMonthly(parseFloat(amountInput.value) || 0, freqSelect.value);
                }
            });

            // Savings
            monthlyCategoryTotals.savings += getMonthlyValue('savings_children', 'savings_children_freq');
            monthlyCategoryTotals.savings += getMonthlyValue('savings_sands', 'savings_sands_freq');
            monthlyCategoryTotals.savings += getMonthlyValue('savings_james', 'savings_james_freq');
            monthlyCategoryTotals.savings += getMonthlyValue('savings_other', 'savings_other_freq');

            // Other Expenses
            monthlyCategoryTotals.other += getMonthlyValue('other_nationalTrust', 'other_nationalTrust_freq');
            monthlyCategoryTotals.other += getMonthlyValue('other_miscellaneous', 'other_miscellaneous_freq');


            // Sum all category totals for overall monthly outgoings
            for (const category in monthlyCategoryTotals) {
                totalMonthlyOutgoings += monthlyCategoryTotals[category];
            }

            const totalAnnualOutgoings = totalMonthlyOutgoings * 12;

            const monthlyMoneyLeft = globalMonthlyNetPay - totalMonthlyOutgoings;
            const annualMoneyLeft = globalAnnualNetPay - totalAnnualOutgoings;

            // Display Monthly Costs Summary
            document.getElementById('summary_housing').textContent = formatCurrency(monthlyCategoryTotals.housing);
            document.getElementById('summary_services').textContent = formatCurrency(monthlyCategoryTotals.services);
            document.getElementById('summary_car1').textContent = formatCurrency(monthlyCategoryTotals.car1); // Display car 1 summary
            document.getElementById('summary_car2').textContent = formatCurrency(monthlyCategoryTotals.car2); // Display car 2 summary
            document.getElementById('summary_professionalExpenses').textContent = formatCurrency(monthlyCategoryTotals.professionalExpenses); // Display Professional Expenses summary
            document.getElementById('summary_dora').textContent = formatCurrency(monthlyCategoryTotals.dora); // Display Dora summary
            document.getElementById('summary_subscriptions').textContent = formatCurrency(monthlyCategoryTotals.subscriptions);
            document.getElementById('summary_debt').textContent = formatCurrency(monthlyCategoryTotals.debt);
            document.getElementById('summary_savings').textContent = formatCurrency(monthlyCategoryTotals.savings);
            document.getElementById('summary_other').textContent = formatCurrency(monthlyCategoryTotals.other); // Display Other summary


            document.getElementById('totalMonthlyOutgoings').textContent = formatCurrency(totalMonthlyOutgoings);
            document.getElementById('totalAnnualOutgoings').textContent = formatCurrency(totalAnnualOutgoings);
            document.getElementById('moneyLeftMonthly').textContent = formatCurrency(monthlyMoneyLeft);
            document.getElementById('moneyLeftAnnual').textContent = formatCurrency(annualMoneyLeft);
        }

        /**
         * Adds a new debt item row to the outgoings page.
         */
        function addDebtItem() {
            const container = document.getElementById('debt-items-container');
            const newItem = document.createElement('div');
            newItem.className = 'debt-item flex flex-col md:flex-row items-start md:items-center gap-2';
            newItem.innerHTML = `
                <input type="text" placeholder="e.g., New Loan" class="input-field flex-grow" aria-label="Debt Name">
                <input type="number" value="0" min="0" class="input-field w-24" oninput="calculateOutgoings()" aria-label="Debt Amount">
                <select class="select-field w-auto" onchange="calculateOutgoings()" aria-label="Debt Frequency">
                    <option value="monthly">Monthly</option>
                    <option value="quarterly">Quarterly</option>
                    <option value="annually">Annually</option>
                </select>
                <button onclick="removeDebtItem(this)" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-3 rounded-lg shadow-sm transition duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-75 flex-shrink-0">
                    Delete
                </button>
            `;
            container.appendChild(newItem);
            calculateOutgoings(); // Recalculate after adding
        }

        /**
         * Removes a debt item row from the outgoings page.
         * @param {HTMLElement} button - The delete button clicked.
         */
        function removeDebtItem(button) {
            const itemToRemove = button.closest('.debt-item');
            if (itemToRemove) {
                itemToRemove.remove();
                calculateOutgoings(); // Recalculate after removing
            }
        }


        /**
         * Handles page navigation.
         * @param {string} pageId - The ID of the page to show (e.g., 'page-calculator', 'page-outgoings').
         */
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');

            // If navigating to outgoings page, update its display with net pay
            if (pageId === 'page-outgoings') {
                document.getElementById('outgoingsMonthlyNet').textContent = formatCurrency(globalMonthlyNetPay);
                document.getElementById('outgoingsAnnualNet').textContent = formatCurrency(globalAnnualNetPay);
                calculateOutgoings(); // Recalculate outgoings when page is shown
            }
        }

        // Initial calculations and page setup on load
        window.onload = function() {
            calculatePay(); // Calculate initial pay
            showPage('page-calculator'); // Show the calculator page by default
        };
    </script>
</body>
</html>


